<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <title>Калькулятор благоустройства</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <h1>Калькулятор благоустройства</h1>
    
    <div class="container">
        <div class="buttons-section">
            <!-- Расчистка участка -->
            <div class="button-group">
                <h3><i class="fas fa-tractor"></i> Расчистка участка</h3>
                <button onclick="addCustom('Трактор смена (7 часов работы + 1 час подачи) - 32,000', 32000)"><i class="fas fa-tractor"></i> Трактор смена - 32,000</button>
                <button onclick="addCustom('Контейнер 27м3 - 35,000', 35000)"><i class="fas fa-truck"></i> Контейнер 27м3 - 35,000</button>
                <button onclick="addCustom('Контейнер 20м3 - 30,000', 30000)"><i class="fas fa-truck"></i> Контейнер 20м3 - 30,000</button>
                <button onclick="addCustom('Самосвал 20м3 - 25,000', 25000)"><i class="fas fa-truck"></i> Самосвал 20м3 - 25,000</button>
                <button onclick="addCustom('Газель 8м3 - 15,000', 15000)"><i class="fas fa-van-shuttle"></i> Газель 8м3 - 15,000</button>
                <button onclick="addCustom('Чипер+оператор на измельчение порубочных остатков - 45,000', 45000)"><i class="fas fa-cut"></i> Чипер+оператор - 45,000</button>
                <div class="custom-price">
                    <input type="number" id="takelazhPrice" placeholder="Такелажные работы Цена (руб)" inputmode="decimal">
                    <button onclick="addCustomPrice('Такелажные работы', 'takelazhPrice')"><i class="fas fa-tools"></i> Добавить</button>
                </div>
                <div class="custom-price">
                    <input type="number" id="clearingPrice" placeholder="Расчистка под грабли Цена (руб)" inputmode="decimal">
                    <button onclick="addCustomPrice('Расчистка участка под грабли/такелажные работы', 'clearingPrice')"><i class="fas fa-rake"></i> Добавить</button>
                </div>
                <div class="custom-price">
                    <input type="number" id="spilPrice" placeholder="Спил/распил Цена (руб)" inputmode="decimal">
                    <button onclick="addCustomPrice('Безопасный спил/распил на носимые части', 'spilPrice')"><i class="fas fa-cut"></i> Добавить</button>
                </div>
                <button onclick="addCustom('Бригадир смена - 7,000', 7000)"><i class="fas fa-user-tie"></i> Бригадир смена - 7,000</button>
            </div>
            
            <!-- Выравнивание участка -->
            <div class="button-group">
                <h3><i class="fas fa-shovel"></i> Выравнивание участка</h3>
                <button onclick="addCustom('Трактор смена - 32,000', 32000)"><i class="fas fa-tractor"></i> Трактор смена - 32,000</button>
                <button onclick="addCustom('Самосвал 20м3 - 25,000', 25000)"><i class="fas fa-truck"></i> Самосвал 20м3 - 25,000</button>
                <div class="custom-price">
                    <input type="number" id="takelazhLevelingPrice" placeholder="Такелажные работы Цена (руб)" inputmode="decimal">
                    <button onclick="addCustomPrice('Такелажные работы', 'takelazhLevelingPrice')"><i class="fas fa-tools"></i> Добавить</button>
                </div>
                <div class="custom-price">
                    <input type="number" id="sandVolume" placeholder="Песок (м³)" inputmode="decimal">
                    <button onclick="addVolume('Песок', 'sandVolume', 15000, '10м³')"><i class="fas fa-dune"></i> Добавить Песок</button>
                </div>
                <div class="custom-price">
                    <input type="number" id="gravelVolume" placeholder="Щебень (м³)" inputmode="decimal">
                    <button onclick="addVolume('Щебень', 'gravelVolume', 33000, '10м³')"><i class="fas fa-road"></i> Добавить Щебень</button>
                </div>
                <div class="custom-price">
                    <input type="number" id="planningGroundVolume" placeholder="Планировочный грунт (м³)" inputmode="decimal">
                    <button onclick="addVolume('Планировочный грунт', 'planningGroundVolume', 20000, '10м³')"><i class="fas fa-layer-group"></i> Добавить Грунт</button>
                </div>
                <div class="custom-price">
                    <input type="number" id="fertileGroundVolume" placeholder="Плодородный грунт (м³)" inputmode="decimal">
                    <button onclick="addVolume('Плодородный грунт', 'fertileGroundVolume', 35000, '10м³')"><i class="fas fa-leaf"></i> Добавить Грунт</button>
                </div>
                <button onclick="addCustom('Бригадир смена - 7,000', 7000)"><i class="fas fa-user-tie"></i> Бригадир смена - 7,000</button>
            </div>
            
            <!-- Устройство газона -->
            <div class="button-group">
                <h3><i class="fas fa-seedling"></i> Устройство посевного или рулонного газона</h3>
                <div class="custom-price">
                    <input type="number" id="pokosPrice" placeholder="Покос/скарификация Цена (руб)" inputmode="decimal">
                    <button onclick="addCustomPrice('Покос, скарификация, сбор скошенной травы', 'pokosPrice')"><i class="fas fa-leaf"></i> Добавить</button>
                </div>
                <div class="custom-price">
                    <input type="number" id="clearingLawnPrice" placeholder="Расчистка под грабли Цена (руб)" inputmode="decimal">
                    <button onclick="addCustomPrice('Расчистка участка под грабли/такелажные работы', 'clearingLawnPrice')"><i class="fas fa-rake"></i> Добавить</button>
                </div>
                <div class="custom-price">
                    <input type="number" id="takelazhLawnPrice" placeholder="Планирование грунта по участку Цена (руб)" inputmode="decimal">
                    <button onclick="addCustomPrice('Планирование грунта по участку', 'takelazhLawnPrice')"><i class="fas fa-tools"></i> Добавить</button>
                </div>
                <div class="custom-price">
                    <input type="number" id="fertileGroundLawnVolume" placeholder="Плодородный грунт (м³)" inputmode="decimal">
                    <button onclick="addVolume('Плодородный грунт', 'fertileGroundLawnVolume', 35000, '10м³')"><i class="fas fa-leaf"></i> Добавить Грунт</button>
                </div>
                <button onclick="addCustom('Контейнер 8м3 под мусор - 15,000', 15000)"><i class="fas fa-truck"></i> Контейнер 8м3 - 15,000</button>
                <div class="custom-price" style="display: flex; flex-direction: column; gap: 8px;">
                    <div class="input-group">
                        <input type="number" id="frezPrice" placeholder="Цена за сотку (руб)" value="10000" inputmode="decimal">
                        <input type="number" id="frezArea" placeholder="Кол-во соток" inputmode="decimal">
                    </div>
                    <button onclick="addAreaBased('Фрезеровка мини-трактором с ручным выравниванием', 'frezPrice', 'frezArea', 'сотка')"><i class="fas fa-tractor"></i> Добавить Фрезеровку</button>
                </div>
                <div class="custom-price" style="display: flex; flex-direction: column; gap: 8px;">
                    <div class="input-group">
                        <input type="number" id="seededLawnPrice" placeholder="Цена за м² (руб)" value="300" inputmode="decimal">
                        <input type="number" id="seededLawnArea" placeholder="Площадь (м²)" inputmode="decimal">
                    </div>
                    <button onclick="addSeededLawnButton()"><i class="fas fa-seedling"></i> Добавить Посевной газон</button>
                </div>
                <div class="custom-price" style="display: flex; flex-direction: column; gap: 8px;">
                    <div class="input-group">
                        <input type="number" id="rolledLawnPrice" placeholder="Цена за м² (руб)" value="900" inputmode="decimal">
                        <input type="number" id="rolledLawnArea" placeholder="Площадь (м²)" inputmode="decimal">
                    </div>
                    <button onclick="addRolledLawnButton()"><i class="fas fa-seedling"></i> Добавить Рулонный газон</button>
                </div>
                <button onclick="addCustom('Бригадир смена - 7,000', 7000)"><i class="fas fa-user-tie"></i> Бригадир смена - 7,000</button>
                
            </div>
            
            <!-- Спил деревьев -->
            <div class="button-group">
                <h3><i class="fas fa-tree"></i> Спил деревьев</h3>
                <div class="custom-price">
                    <input type="number" id="spilTreePrice" placeholder="Спил/распил Цена (руб)" inputmode="decimal">
                    <button onclick="addCustomPrice('Безопасный спил/распил на носимые части', 'spilTreePrice')"><i class="fas fa-cut"></i> Добавить</button>
                </div>
                <button onclick="addCustom('Газель 8м3 - 15,000', 15000)"><i class="fas fa-van-shuttle"></i> Газель 8м3 - 15,000</button>
                <button onclick="addCustom('Контейнер 27м3 - 35,000', 35000)"><i class="fas fa-truck"></i> Контейнер 27м3 - 35,000</button>
                <button onclick="addCustom('Чипер+оператор на измельчение порубочных остатков - 45,000', 45000)"><i class="fas fa-cut"></i> Чипер+оператор - 45,000</button>
                <div class="custom-price">
                    <input type="number" id="stumpPrice" placeholder="Фрезеровка пней Цена (руб)" inputmode="decimal">
                    <button onclick="addCustomPrice('Фрезеровка пней', 'stumpPrice')"><i class="fas fa-tools"></i> Добавить</button>
                </div>
                <div class="custom-price">
                    <input type="number" id="takelazhTreePrice" placeholder="Такелажные работы Цена (руб)" inputmode="decimal">
                    <button onclick="addCustomPrice('Такелажные работы', 'takelazhTreePrice')"><i class="fas fa-tools"></i> Добавить</button>
                </div>
                <button onclick="addCustom('Бригадир смена - 7,000', 7000)"><i class="fas fa-user-tie"></i> Бригадир смена - 7,000</button>
            </div>
            <div class="controls-group">
    <h3>Благоустройство участка</h3>
    <div class="input-group">
        <input type="number" id="pavingSandPrice" placeholder="Цена за м²">
        <input type="number" id="pavingSandArea" placeholder="Площадь, м²">
    </div>
    <button onclick="addPavingSandButton()">Добавить Брусчатку на песчано-щебневом основании</button>
    <div class="input-group">
        <input type="number" id="pavingConcretePrice" placeholder="Цена за м²">
        <input type="number" id="pavingConcreteArea" placeholder="Площадь, м²">
    </div>
    <button onclick="addPavingConcreteButton()">Добавить Брусчатку на бетонном основании</button>
    <div class="input-group">
      <button onclick="addDrivewayButton()">Добавить Въездную группу с дренажной трубой</button>
    </div>
    
</div>
        </div>
        
        <div class="chat-section" id="chat">
            <div class="message">Предварительный расчёт по Вашему запросу:</div>
        </div>
    </div>
    
    <div class="total" id="total">Итого: 0</div>
    
    <div class="action-buttons">
        <button class="clear-btn" onclick="clearChat()"><i class="fas fa-trash"></i> Очистить всё</button>
        <button class="copy-btn" onclick="copyChatToClipboard()"><i class="fas fa-copy"></i> Копировать расчёт</button>
    </div>
    
    <div class="copy-notice" id="copyNotice"></div>
    
    <script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
    </script>
    <script src="script.js"></script>
</body>
</html>
